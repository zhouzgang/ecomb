## 文件系统
> 整理文件系统分享内容
思路：跟随上次分享的思路，简单介绍文件系统的原理。
不用讲的太深，主要还是对目标用户有价值。
参考课程讲解思路

**流程**
- 图灵机，图灵完备语言，主要介绍纸带部分
- 介绍磁盘结构，读写寻址
- 介绍文件系统设计结构图
- 文件系统的问题，题目，做一遍教程上的题目

inode/block 对比 MySql 索引的 b+tree
空间管理，对比 JVM 的内存管理
文件读取，I/O 部分

**文件系统的功能规划**
- 第一点，文件系统要有严格的组织形式，使得文件能够以块为单位进行存储。
- 第二点，文件系统中也要有索引区，用来方便查找一个文件分成的多个块都存放在了什么位置。
- 第三点，如果文件系统中有的文件是热点文件，近期经常被读取和写入，文件系统应该有缓存层。
- 第四点，文件应该用文件夹的形式组织起来，方便管理和查询。
- 第五点，Linux 内核要在自己的内存里面维护一套数据结构，来保存哪些文件被哪些进程打开和使用。

```shell
fdisk -l
mkfs.ext4 /dev/vdc
fdisk /dev/vdc
mount /dev/vdc1 /根目录/用户A目录/目录1
umount /根目录/用户A目录/目录1
```

- 表示普通文件；
d 表示文件夹；
c 表示字符设备文件，这在设备那一节讲解；
b 表示块设备文件，这也在设备那一节讲解；
s 表示套接字 socket 文件，这在网络那一节讲解；
l 表示符号链接，也即软链接，就是通过名字指向另外一个文件，例如下面的代码，instance 这个文件就是指向了 /var/lib/cloud/instances 这个文件。软链接的机制我们这一章会讲解。


**记录**
- 文件描述符，就是用来区分一个进程打开的多个文件的。它的作用域就是当前进程，出了当前进程这个文件描述符就没有意义了。
- 检查当前block的大小的简单方法就是echo aaa > aa.txt,这个时候du -sh,会发现占据4K的大小
- 地址大小，32bit/64bit，那么地址大小就是 4B/8B



位图
3. 使用案列#
给定10亿个不重复的正int的整数，没排过序的，然后再给一个数，如何快速判断这个数是否在那10亿个数当中。
解法：遍历40个亿数字，映射到BitMap中，然后对于给出的数，直接判断指定的位上存在不存在即可。

使用位图法判断正整形数组是否存在重复
解法：遍历一遍，存在之后设置成1，每次放之前先判断是否存在，如果存在，就代表该元素重复。

使用位图法进行元素不重复的正整形数组排序
解法：遍历一遍，设置状态1，然后再次遍历，对状态等于1的进行输出，参考计数排序的原理。

在2.5亿个整数中找出不重复的正整数，注，内存不足以容纳这2.5亿个整数
解法1：采用2-Bitmap（每个数分配2bit，00表示不存在，01表示出现一次，10表示多次，11无意义）。

解法2：采用两个BitMap，即第一个Bitmap存储的是整数是否出现，接着，在之后的遍历先判断第一个BitMap里面是否出现过，如果出现就设置第二个BitMap对应的位置也为1，最后遍历BitMap，仅仅在一个BitMap中出现过的元素，就是不重复的整数。

解法3：分治+Hash取模，拆分成多个小文件，然后一个个文件读取，直到内存装的下，然后采用Hash+Count的方式判断即可。

该类问题的变形问题，如已知某个文件内包含一些电话号码，每个号码为8位数字，统计不同号码的个数。8位最多99 999 999，大概需要99m个bit，大概10几m字节的内存即可。 （可以理解为从0-99 999 999的数字，每个数字对应一个Bit位，所以只需要99M个Bit==12MBytes，这样，就用了小小的12M左右的内存表示了所有的8位数的电话）

