### 减库存记录

**流程**
- 判断库存
- 创建订单
- 减库存
- 创建订单明细
- 订单流水
- （订单支付，订单物流，订单评论……）

**方案**
1. 使用乐观锁实现
```sql
update tbl_product set stock = stock - ? where id = ? and stock - ? >= 0;
```


### 参考
- [高并发库存秒杀场景](https://zhuanlan.zhihu.com/p/134012175)  这里用了分段/桶的思路，实现起来会比较麻烦。
- [高并发下库存扣减解决方案--分布式锁](https://www.jianshu.com/p/9a04aaaf6e87) 这里的 库存占用 思路挺好的。
- [高并发场景-订单库存防止超卖](https://juejin.cn/post/6844904030158716941#heading-10) 这里的方案4，有思考价值，但是存在问题。
- 只从分析来看，不好找到那个方案更好，也要看具体场景，数据量。比如商品数量很大。